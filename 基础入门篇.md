Docker åŸºç¡€å…¥é—¨ç¯‡
---

### ç›®å½•

1. [å®‰è£…](#2-å®‰è£…)
    - 1.1. [ç³»ç»Ÿè¦æ±‚](#11-ç³»ç»Ÿè¦æ±‚)
    - 1.2. [è‡ªåŠ¨å®‰è£…è„šæœ¬](#12-è‡ªåŠ¨å®‰è£…è„šæœ¬)
    - 1.3. [æ‰‹åŠ¨å®‰è£…](#13-æ‰‹åŠ¨å®‰è£…)
2. [é•œåƒ](#2-é•œåƒ)
	- 3.1. [å¸¸ç”¨æ“ä½œå‘½ä»¤](#21-å¸¸ç”¨æ“ä½œå‘½ä»¤)
	- 3.2. [é•œåƒåŠ é€Ÿå™¨](#22-é•œåƒåŠ é€Ÿå™¨)
3. [å®¹å™¨](#3-å®¹å™¨)
	- 3.1. [å¸¸ç”¨æ“ä½œå‘½ä»¤](#31-å¸¸ç”¨æ“ä½œå‘½ä»¤)
4. [é™„å½•](#4-é™„å½•)
	- 4.1. [Docker å¸¸ç”¨å‘½ä»¤å›¾è§£](#41-docker-å¸¸ç”¨å‘½ä»¤å›¾è§£) 

---


### 1. å®‰è£…

#### 1.1. ç³»ç»Ÿè¦æ±‚ï¼ˆx64 ä½ã€å†…æ ¸ç‰ˆæœ¬ >= 3.10ï¼‰

> å¯é€šè¿‡å‘½ä»¤ uname -a æŸ¥çœ‹ç³»ç»ŸåŸºæœ¬ä¿¡æ¯

+ Ubuntu 16.04 Xenial +
+ Debian 8 Jessie +
+ CentOS7 +

#### 1.2. è‡ªåŠ¨å®‰è£…è„šæœ¬ï¼ˆé€‚ç”¨äº Ubuntuã€Debianã€CentOSï¼‰ ğŸ‘

```bash
# å®˜æ–¹
$ curl -sSL https://get.docker.com/ | sh

# é˜¿é‡Œäº‘
$ curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -

# DaoCloud
$ curl -sSL https://get.daocloud.io/docker | sh
```

æ³¨æ„ï¼šè‡ªåŠ¨å®‰è£…è„šæœ¬åªå®‰è£… docker-enginieï¼Œå¦‚æœéœ€è¦ä½¿ç”¨ docker-composeï¼Œè¯·æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤å®‰è£…

```bash
$ curl -L https://github.com/docker/compose/releases/download/1.19.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose
$ chmod +x /usr/local/bin/docker-compose
$ docker-compose -v
```

#### 1.3. æ‰‹åŠ¨å®‰è£…

+ [Ubuntu](https://www.docker.com/docker-ubuntu)
+ [Debian](https://www.docker.com/docker-debian)
+ [CentOS](https://www.docker.com/docker-centos-distribution)
    
### 2. é•œåƒ

Docker é•œåƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®ç­‰æ–‡ä»¶å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„ä¸€äº›é…ç½®å‚æ•°ï¼ˆå¦‚åŒ¿åå·ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰ï¼‰ã€‚**é•œåƒä¸åŒ…å«ä»»ä½•åŠ¨æ€æ•°æ®ï¼Œå…¶å†…å®¹åœ¨æ„å»ºä¹‹åä¹Ÿä¸ä¼šè¢«æ”¹å˜ã€‚**

Docker é•œåƒæ˜¯æ€ä¹ˆå®ç°å¢é‡çš„ä¿®æ”¹å’Œç»´æŠ¤çš„ï¼Ÿ æ¯ä¸ªé•œåƒéƒ½ç”±å¾ˆå¤šå±‚æ¬¡æ„æˆï¼ŒDocker ä½¿ç”¨ [Union FS](https://en.wikipedia.org/wiki/Union_mount) å°†è¿™äº›ä¸åŒçš„å±‚ç»“åˆåˆ°ä¸€ä¸ªé•œåƒä¸­å»ã€‚

é€šå¸¸ Union FS æœ‰ä¸¤ä¸ªç”¨é€”ï¼š

- å®ç°ä¸å€ŸåŠ© LVMã€RAID å°†å¤šä¸ª disk æŒ‚åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ï¼›
- å°†ä¸€ä¸ªåªè¯»çš„åˆ†æ”¯å’Œä¸€ä¸ªå¯å†™çš„åˆ†æ”¯è”åˆåœ¨ä¸€èµ·ï¼ŒLive CD æ­£æ˜¯åŸºäºæ­¤æ–¹æ³•å¯ä»¥å…è®¸åœ¨é•œåƒä¸å˜çš„åŸºç¡€ä¸Šå…è®¸ç”¨æˆ·åœ¨å…¶ä¸Šè¿›è¡Œä¸€äº›å†™æ“ä½œã€‚

Docker åœ¨ AUFS ä¸Šæ„å»ºçš„å®¹å™¨ä¹Ÿæ˜¯åˆ©ç”¨äº†ç±»ä¼¼çš„åŸç†ã€‚

#### 2.1. å¸¸ç”¨æ“ä½œå‘½ä»¤

```bash
# æœç´¢é•œåƒ
$ docker search ubuntu:16.04

# è·å–é•œåƒ
$ docker pull [é€‰é¡¹] [Docker Registryåœ°å€]<ä»“åº“å>:<æ ‡ç­¾>

# åˆ—å‡ºé•œåƒï¼ˆåªä¼šæ˜¾ç¤ºé¡¶å±‚é•œåƒï¼‰
$ docker images

# åˆ é™¤é•œåƒï¼ˆéœ€è¦å…ˆåˆ é™¤ä¾èµ–è¯¥é•œåƒçš„å®¹å™¨ï¼‰
$ docker rmi [é€‰é¡¹] <é•œåƒ1> [<é•œåƒ2> ...]

# åˆ é™¤æ‰€æœ‰è™šæ‚¬é•œåƒ
$ docker rmi $(docker images -q -f dangling=true)

# åˆ é™¤æ‰€æœ‰ä»“åº“ååŒ…å« redis çš„é•œåƒ
$ docker rmi $(docker images -q redis)

# ä¿®æ”¹é•œåƒæ ‡ç­¾
$ sudo docker tag <é•œåƒID> <æ ‡ç­¾å>

# å¯¼å‡ºé•œåƒå­˜å‚¨æ–‡ä»¶
$ docker save -o å¯¼å‡ºé•œåƒå.tar.gz <é•œåƒID æˆ– é•œåƒå:tag>

# å¯¼å…¥é•œåƒå­˜å‚¨æ–‡ä»¶ï¼ˆåŒ…å«é•œåƒä»¥åŠç›¸å…³å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚æ ‡ç­¾ç­‰ï¼‰
$ docker load < å¯¼å‡ºé•œåƒå.tar.gz
æˆ–
$ docker load --input å¯¼å‡ºé•œåƒå.tar.gz

# å…¶å®ƒ

```

#### 2.2. é•œåƒåŠ é€Ÿå™¨ ğŸ‘

ç”±äºå›½å†…è®¿é—® Docker Hub æœ‰æ—¶ä¼šé‡åˆ°å›°éš¾ï¼Œæ‰€ä»¥éœ€è¦é…ç½®é•œåƒåŠ é€Ÿå™¨ï¼Œæ¨èå¦‚ä¸‹ä¸¤ä¸ªï¼š

+ [DaoCloud](https://www.daocloud.io/mirror)
+ [é˜¿é‡Œäº‘](https://account.aliyun.com/login/login.htm?oauth_callback=https%3A%2F%2Fcr.console.aliyun.com%2F&lang=zh#/accelerator)

### 3. å®¹å™¨

é•œåƒï¼ˆImageï¼‰å’Œå®¹å™¨ï¼ˆContainerï¼‰çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ç±»å’Œå®ä¾‹ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚

å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ã€‚

å®¹å™¨çš„å®è´¨æ˜¯**è¿›ç¨‹**ï¼Œä½†ä¸ç›´æ¥åœ¨å®¿ä¸»æ‰§è¡Œçš„è¿›ç¨‹ä¸åŒï¼Œå®¹å™¨è¿›ç¨‹è¿è¡Œäºå±äºè‡ªå·±çš„ç‹¬ç«‹çš„ å‘½åç©ºé—´ã€‚å› æ­¤å®¹å™¨å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„ root æ–‡ä»¶ç³»ç»Ÿã€è‡ªå·±çš„ç½‘ç»œé…ç½®ã€è‡ªå·±çš„è¿›ç¨‹ç©ºé—´ï¼Œç”šè‡³è‡ªå·±çš„ç”¨æˆ· ID ç©ºé—´ã€‚å®¹å™¨å†…çš„è¿›ç¨‹æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒé‡Œï¼Œä½¿ç”¨èµ·æ¥ï¼Œå°±å¥½åƒæ˜¯åœ¨ä¸€ä¸ªç‹¬ç«‹äºå®¿ä¸»çš„ç³»ç»Ÿä¸‹æ“ä½œä¸€æ ·ã€‚è¿™ç§ç‰¹æ€§ä½¿å¾—å®¹å™¨å°è£…çš„åº”ç”¨æ¯”ç›´æ¥åœ¨å®¿ä¸»è¿è¡Œæ›´åŠ å®‰å…¨ã€‚ä¹Ÿå› ä¸ºè¿™ç§éš”ç¦»çš„ç‰¹æ€§ï¼Œå¾ˆå¤šäººåˆå­¦ Docker æ—¶å¸¸å¸¸ä¼šæŠŠå®¹å™¨å’Œè™šæ‹Ÿæœºææ··ã€‚

> æŒ‰ç…§ Docker æœ€ä½³å®è·µçš„è¦æ±‚ï¼Œ**å®¹å™¨ä¸åº”è¯¥å‘å…¶å­˜å‚¨å±‚å†…å†™å…¥ä»»ä½•æ•°æ®ï¼Œå®¹å™¨å­˜å‚¨å±‚è¦ä¿æŒæ— çŠ¶æ€åŒ–**ã€‚æ‰€æœ‰çš„æ–‡ä»¶å†™å…¥æ“ä½œï¼Œéƒ½åº”è¯¥ä½¿ç”¨ æ•°æ®å·ï¼ˆVolumeï¼‰ã€æˆ–è€…ç»‘å®šå®¿ä¸»ç›®å½•ï¼Œåœ¨è¿™äº›ä½ç½®çš„è¯»å†™ä¼šè·³è¿‡å®¹å™¨å­˜å‚¨å±‚ï¼Œç›´æ¥å¯¹å®¿ä¸»(æˆ–ç½‘ç»œå­˜å‚¨)å‘ç”Ÿè¯»å†™ï¼Œå…¶æ€§èƒ½å’Œç¨³å®šæ€§æ›´é«˜ã€‚

#### 3.1. å¸¸ç”¨æ“ä½œå‘½ä»¤

```bash
# è¾“å‡ºä¸€ä¸ªâ€œhello worldâ€åç»ˆæ­¢å®¹å™¨
$ docker run ubuntu:16.04 /bin/echo 'hello world'
hello world

# å¯åŠ¨ä¸€ä¸ª bash ç»ˆç«¯ï¼Œå…è®¸ç”¨æˆ·è¿›è¡Œäº¤äº’
$ docker run -it ubuntu:16.04 /bin/bash 
root@0eb917598209:/# exit 
exit
$

# åå°è¿è¡Œï¼Œä¸»è¦ä½¿ç”¨ -d å‚æ•°
$ docker run -d ubuntu:16.04 /bin

# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
$ docker ps

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
$ docker ps -a

# è¿›å…¥å®¹å™¨
# æ–¹æ³•ä¸€ï¼šattach æ­¤æ–¹æ³•ä¼šå—å‘½ä»¤é˜»å¡å½±å“ï¼Œå¹¶ä¸” exit é€€å‡ºåå°†åŒæ—¶å…³é—­å®¹å™¨
$ docker attach <å®¹å™¨id>
# æ–¹æ³•äºŒï¼šexecï¼ˆæ¨èï¼‰
$ docker exec -it $CONTAINER_ID /bin/bash

# å…³é—­å®¹å™¨
$ docker stop $CONTAINER_ID

# å¯åŠ¨å·²å…³é—­çš„å®¹å™¨
$ docker start $CONTAINER_ID

# è·å–å®¹å™¨çš„è¾“å‡ºä¿¡æ¯ï¼ˆ-f é€‰é¡¹ç”¨äºæŒç»­è·å–ï¼‰
$ docker logs $CONTAINER_ID

# æŸ¥çœ‹å®¹å™¨çš„ç›¸å…³ä¿¡æ¯
$ docker inspect $CONTAINER_ID

# åˆ é™¤å®¹å™¨
$ docker rm $CONTAINER_ID-1 $CONTAINER_ID-2 $CONTAINER_ID-3 ...

# åˆ é™¤æ‰€æœ‰æœªè¿è¡Œçš„å®¹å™¨
$ docker rm $(docker ps -a -q)

# å¯¼å‡ºå®¹å™¨å¿«ç…§ï¼ˆå°†ä¸¢å¼ƒå†å²è®°å½•å’Œå…ƒæ•°æ®ä¿¡æ¯ï¼‰
$ docker export <å®¹å™¨ID> > <å¯¼å‡ºæ–‡ä»¶å>.tar

# ä»å®¹å™¨å¿«ç…§å¯¼å…¥é•œåƒ
$ cat <å¯¼å‡ºæ–‡ä»¶å>.tar | docker import - <å¯¼å…¥ä¹‹åçš„é•œåƒå:æ ‡ç­¾>

# åœ¨å®¿ä¸»æœºä¸å®¹å™¨ä¹‹é—´ç›¸äº’æ‹·è´æ–‡ä»¶
$ docker cp [OPTIONS] $CONTAINER_ID:å®¹å™¨ä¸­çš„æ–‡ä»¶è·¯å¾„ æœ¬åœ°ç›®æ ‡è·¯å¾„
$ docker cp [OPTIONS] æœ¬åœ°æ–‡ä»¶è·¯å¾„ $CONTAINER_ID:å®¹å™¨ä¸­çš„ç›®æ ‡è·¯å¾„
```

### 4. é™„å½•

#### 4.1. Docker å¸¸ç”¨å‘½ä»¤å›¾è§£

![docker commands](./images/docker-commands.png)